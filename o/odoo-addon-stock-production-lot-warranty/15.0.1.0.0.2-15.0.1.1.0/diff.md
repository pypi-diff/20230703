# Comparing `tmp/odoo_addon_stock_production_lot_warranty-15.0.1.0.0.2-py3-none-any.whl.zip` & `tmp/odoo_addon_stock_production_lot_warranty-15.0.1.1.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,24 +1,24 @@
-Zip file size: 26764 bytes, number of entries: 22
--rw-r--r--  2.0 unx     4170 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/README.rst
--rw-r--r--  2.0 unx       86 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/__init__.py
--rw-r--r--  2.0 unx      684 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/__manifest__.py
--rw-r--r--  2.0 unx      928 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/i18n/pt.po
--rw-r--r--  2.0 unx      926 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/i18n/pt_BR.po
--rw-r--r--  2.0 unx      731 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/i18n/stock_production_lot_warranty.pot
--rw-r--r--  2.0 unx       99 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/models/__init__.py
--rw-r--r--  2.0 unx     1875 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/models/stock_production_lot.py
--rw-r--r--  2.0 unx      269 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/readme/CONFIGURE.rst
--rw-r--r--  2.0 unx      178 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx      159 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/readme/CREDITS.rst
--rw-r--r--  2.0 unx      202 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx      302 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/readme/USAGE.rst
--rw-r--r--  2.0 unx     9455 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/static/description/icon.png
--rw-r--r--  2.0 unx    14345 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/static/description/index.html
--rw-r--r--  2.0 unx      199 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/tests/__init__.py
--rw-r--r--  2.0 unx      935 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/tests/test_product_lot_warranty.py
--rw-r--r--  2.0 unx      537 b- defN 22-Jul-26 07:19 odoo/addons/stock_production_lot_warranty/views/stock_production_lot.xml
--rw-r--r--  2.0 unx     4850 b- defN 22-Jul-26 07:19 odoo_addon_stock_production_lot_warranty-15.0.1.0.0.2.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 22-Jul-26 07:19 odoo_addon_stock_production_lot_warranty-15.0.1.0.0.2.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 22-Jul-26 07:19 odoo_addon_stock_production_lot_warranty-15.0.1.0.0.2.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     2605 b- defN 22-Jul-26 07:19 odoo_addon_stock_production_lot_warranty-15.0.1.0.0.2.dist-info/RECORD
-22 files, 43632 bytes uncompressed, 22220 bytes compressed:  49.1%
+Zip file size: 27031 bytes, number of entries: 22
+-rw-r--r--  2.0 unx     4170 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/README.rst
+-rw-r--r--  2.0 unx       86 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/__init__.py
+-rw-r--r--  2.0 unx      684 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/__manifest__.py
+-rw-r--r--  2.0 unx      928 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/i18n/pt.po
+-rw-r--r--  2.0 unx      926 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/i18n/pt_BR.po
+-rw-r--r--  2.0 unx      731 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/i18n/stock_production_lot_warranty.pot
+-rw-r--r--  2.0 unx       99 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/models/__init__.py
+-rw-r--r--  2.0 unx     1185 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/models/stock_production_lot.py
+-rw-r--r--  2.0 unx      269 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/readme/CONFIGURE.rst
+-rw-r--r--  2.0 unx      178 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx      159 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/readme/CREDITS.rst
+-rw-r--r--  2.0 unx      202 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx      302 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/readme/USAGE.rst
+-rw-r--r--  2.0 unx     9455 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/static/description/icon.png
+-rw-r--r--  2.0 unx    14345 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/static/description/index.html
+-rw-r--r--  2.0 unx      199 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/tests/__init__.py
+-rw-r--r--  2.0 unx     2926 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/tests/test_product_lot_warranty.py
+-rw-r--r--  2.0 unx      537 b- defN 23-Jul-03 08:28 odoo/addons/stock_production_lot_warranty/views/stock_production_lot.xml
+-rw-r--r--  2.0 unx     4848 b- defN 23-Jul-03 08:28 odoo_addon_stock_production_lot_warranty-15.0.1.1.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jul-03 08:28 odoo_addon_stock_production_lot_warranty-15.0.1.1.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-Jul-03 08:28 odoo_addon_stock_production_lot_warranty-15.0.1.1.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2598 b- defN 23-Jul-03 08:28 odoo_addon_stock_production_lot_warranty-15.0.1.1.0.dist-info/RECORD
+22 files, 44924 bytes uncompressed, 22503 bytes compressed:  49.9%
```

## zipnote {}

```diff
@@ -48,20 +48,20 @@
 
 Filename: odoo/addons/stock_production_lot_warranty/tests/test_product_lot_warranty.py
 Comment: 
 
 Filename: odoo/addons/stock_production_lot_warranty/views/stock_production_lot.xml
 Comment: 
 
-Filename: odoo_addon_stock_production_lot_warranty-15.0.1.0.0.2.dist-info/METADATA
+Filename: odoo_addon_stock_production_lot_warranty-15.0.1.1.0.dist-info/METADATA
 Comment: 
 
-Filename: odoo_addon_stock_production_lot_warranty-15.0.1.0.0.2.dist-info/WHEEL
+Filename: odoo_addon_stock_production_lot_warranty-15.0.1.1.0.dist-info/WHEEL
 Comment: 
 
-Filename: odoo_addon_stock_production_lot_warranty-15.0.1.0.0.2.dist-info/top_level.txt
+Filename: odoo_addon_stock_production_lot_warranty-15.0.1.1.0.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo_addon_stock_production_lot_warranty-15.0.1.0.0.2.dist-info/RECORD
+Filename: odoo_addon_stock_production_lot_warranty-15.0.1.1.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/stock_production_lot_warranty/__manifest__.py

```diff
@@ -1,15 +1,15 @@
 # Copyright (C) 2018 - TODAY, Open Source Integrators
 # Copyright (C) 2021 Serpent Consulting Services
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl).
 
 {
     "name": "Warranty Date on Lot/Serial Numbers",
     "summary": "Add warranty date to stock production lot",
-    "version": "15.0.1.0.0",
+    "version": "15.0.1.1.0",
     "license": "AGPL-3",
     "author": "Open Source Integrators, Odoo Community Association (OCA)",
     "category": "Stock",
     "website": "https://github.com/OCA/rma",
     "depends": ["product_warranty", "stock"],
     "data": ["views/stock_production_lot.xml"],
     "installable": True,
```

## odoo/addons/stock_production_lot_warranty/models/stock_production_lot.py

```diff
@@ -1,48 +1,31 @@
 # Copyright (C) 2018 - TODAY, Open Source Integrators
 # Copyright (C) 2021 Serpent Consulting Services
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl).
 
-from datetime import datetime, timedelta
-
 from dateutil.relativedelta import relativedelta
 
 from odoo import api, fields, models
-from odoo.tools import DEFAULT_SERVER_DATE_FORMAT
+
+DELTA_TYPES = ("day", "week", "month", "year")
 
 
 class StockProductionLot(models.Model):
     _inherit = "stock.production.lot"
 
     warranty_exp_date = fields.Date(string="Warranty Expiration Date")
 
+    def _get_warranty_exp_date(self, start_date=None):
+        if not start_date:
+            start_date = fields.Date.context_today(self)
+        elif hasattr(start_date, "astimezone"):
+            # Datetime object, convert to date
+            start_date = fields.Date.context_today(self, timestamp=start_date)
+        delta_type = self.product_id.product_tmpl_id.warranty_type
+        duration = self.product_id.product_tmpl_id.warranty
+        if not duration or delta_type not in DELTA_TYPES:
+            return False
+        return start_date + relativedelta(**{f"{delta_type}s": duration})
+
     @api.onchange("product_id")
     def _onchange_product_id(self):
-        self.warranty_exp_date = False
-        if (
-            self.product_id
-            and self.product_id.product_tmpl_id.warranty_type
-            and self.product_id.product_tmpl_id.warranty
-        ):
-            warranty_type = self.product_id.product_tmpl_id.warranty_type
-            time = False
-            if warranty_type == "day":
-                time = (
-                    datetime.now()
-                    + timedelta(days=self.product_id.product_tmpl_id.warranty)
-                ).strftime(DEFAULT_SERVER_DATE_FORMAT)
-            elif warranty_type == "week":
-                time = (
-                    datetime.now()
-                    + timedelta(weeks=self.product_id.product_tmpl_id.warranty)
-                ).strftime(DEFAULT_SERVER_DATE_FORMAT)
-            elif warranty_type == "month":
-                time = (
-                    datetime.now()
-                    + relativedelta(months=+self.product_id.product_tmpl_id.warranty)
-                ).strftime(DEFAULT_SERVER_DATE_FORMAT)
-            elif warranty_type == "year":
-                time = (
-                    datetime.now()
-                    + relativedelta(years=+self.product_id.product_tmpl_id.warranty)
-                ).strftime(DEFAULT_SERVER_DATE_FORMAT)
-            self.warranty_exp_date = time
+        self.warranty_exp_date = self._get_warranty_exp_date()
```

## odoo/addons/stock_production_lot_warranty/tests/test_product_lot_warranty.py

```diff
@@ -1,26 +1,82 @@
 # Copyright (C) 2021 Open Source Integrators
 # Copyright (C) 2021 Serpent Consulting Services
 # License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl).
 from datetime import datetime, timedelta
 
+import psycopg2
+
 from odoo.tests import common
 
 
 class TestProductLotWarranty(common.TransactionCase):
-    def test_productlot_warranty(self):
-        company1 = self.env["res.company"].create({"name": "Test company1"})
-        product1 = self.env["product.product"].create(
+    @classmethod
+    def setUpClass(cls):
+        super().setUpClass()
+        cls.company1 = cls.env["res.company"].create({"name": "Test company1"})
+        cls.product1 = cls.env["product.product"].create(
             {
                 "name": "TestProduct",
                 "warranty_type": "day",
                 "warranty": 5,
             }
         )
+
+    def test_productlot_warranty(self):
         production_lot = self.env["stock.production.lot"].create(
-            {"product_id": product1.id, "company_id": company1.id}
+            {"product_id": self.product1.id, "company_id": self.company1.id}
         )
         production_lot._onchange_product_id()
         self.assertEqual(
             production_lot.warranty_exp_date,
             (datetime.now() + timedelta(days=5)).date(),
         )
+
+    def test_productlot_no_product(self):
+        # s.p.lot "product_id" is required=True
+        with self.assertRaises(psycopg2.IntegrityError):
+            self.env["stock.production.lot"].create(
+                {"product_id": False, "company_id": self.company1.id}
+            )
+
+    def test_productlot_no_warranty_type(self):
+        # product.template "warranty_type" is required=True
+        with self.assertRaises(psycopg2.IntegrityError):
+            self.env["product.product"].create(
+                {
+                    "name": "TestProduct",
+                    "warranty_type": False,
+                    "warranty": 5,
+                }
+            )
+
+    def test_productlot_no_warranty(self):
+        product2 = self.env["product.product"].create(
+            {
+                "name": "TestProduct",
+                "warranty_type": "week",
+                "warranty": 0,
+            }
+        )
+        production_lot = self.env["stock.production.lot"].create(
+            {"product_id": product2.id, "company_id": self.company1.id}
+        )
+        production_lot._onchange_product_id()
+        self.assertFalse(production_lot.warranty_exp_date)
+
+    def test_get_warranty_exp_date(self):
+        production_lot = self.env["stock.production.lot"].create(
+            {"product_id": self.product1.id, "company_id": self.company1.id}
+        )
+        timestamp = datetime.now() - timedelta(days=3)
+        self.assertEqual(
+            production_lot._get_warranty_exp_date(),
+            (datetime.now() + timedelta(days=5)).date(),
+        )
+        self.assertEqual(
+            production_lot._get_warranty_exp_date(timestamp),
+            (datetime.now() + timedelta(days=2)).date(),
+        )
+        self.assertEqual(
+            production_lot._get_warranty_exp_date(timestamp.date()),
+            (datetime.now() + timedelta(days=2)).date(),
+        )
```

## Comparing `odoo_addon_stock_production_lot_warranty-15.0.1.0.0.2.dist-info/METADATA` & `odoo_addon_stock_production_lot_warranty-15.0.1.1.0.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: odoo-addon-stock-production-lot-warranty
-Version: 15.0.1.0.0.2
+Version: 15.0.1.1.0
 Summary: Add warranty date to stock production lot
 Home-page: https://github.com/OCA/rma
 Author: Open Source Integrators, Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: AGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
```

## Comparing `odoo_addon_stock_production_lot_warranty-15.0.1.0.0.2.dist-info/RECORD` & `odoo_addon_stock_production_lot_warranty-15.0.1.1.0.dist-info/RECORD`

 * *Files 12% similar despite different names*

```diff
@@ -1,22 +1,22 @@
 odoo/addons/stock_production_lot_warranty/README.rst,sha256=NaDnwQCwwTg_v5KmpO0A1oSCe8TUJ3j59NidhyXWYuQ,4170
 odoo/addons/stock_production_lot_warranty/__init__.py,sha256=ZGjmXT9q1Wc3A9Eb3pRZjwDcSFijPJcJLFSMyZdyxyU,86
-odoo/addons/stock_production_lot_warranty/__manifest__.py,sha256=mllqrRR9en693HMuR8MgJ0VqMfpso2FAim8J1j0FN2k,684
+odoo/addons/stock_production_lot_warranty/__manifest__.py,sha256=wUCpmVm56odnKIK1PkYKzX80NQzkUvzjKlJUfh1jvpU,684
 odoo/addons/stock_production_lot_warranty/i18n/pt.po,sha256=8lYfoPhtvjC1n2L7z6UYNAdu6CJdrTzirS91j9i70rg,928
 odoo/addons/stock_production_lot_warranty/i18n/pt_BR.po,sha256=hM-VQfIZc9h8XYsNeSb-kEj4EVMM4rUASnh_T1mdeI4,926
 odoo/addons/stock_production_lot_warranty/i18n/stock_production_lot_warranty.pot,sha256=sUD_RIXl3-MBacF0CoN_O81x0HA_eTfKO1MKC5rhlFU,731
 odoo/addons/stock_production_lot_warranty/models/__init__.py,sha256=zf2w1wOnqmyrL9XFSWgo5ZGZn9PGkuNdlATRwsUqVa0,99
-odoo/addons/stock_production_lot_warranty/models/stock_production_lot.py,sha256=FQ4LMH9KlJclFcum0mYvoZucsLnJg9ZAews9AK_POiY,1875
+odoo/addons/stock_production_lot_warranty/models/stock_production_lot.py,sha256=8KCtJwlyvHaQzR5Z-yFmSjZpKRu5skWMB9q3muPczK4,1185
 odoo/addons/stock_production_lot_warranty/readme/CONFIGURE.rst,sha256=7Us30ogmeibBbHtkOvQPgLL0uYKZFuTMzFoy90ar54o,269
 odoo/addons/stock_production_lot_warranty/readme/CONTRIBUTORS.rst,sha256=z6sTb2Rt5FQ-0FBCFFGnHXDcU3clrAHEXTgNjSFdHzc,178
 odoo/addons/stock_production_lot_warranty/readme/CREDITS.rst,sha256=2b8PT6cLwY8uo_tVS0zOMpWL0X59ii51bt2g86L75Hs,159
 odoo/addons/stock_production_lot_warranty/readme/DESCRIPTION.rst,sha256=mcXnbDrAxI7Xl6ANgRBjF5OLMg1PRchIzOi4mppCET4,202
 odoo/addons/stock_production_lot_warranty/readme/USAGE.rst,sha256=S35zo19VBlMsey5EfH_A9yFLkPKTe6nXmxRnW3-YWZo,302
 odoo/addons/stock_production_lot_warranty/static/description/icon.png,sha256=6xBPJauaFOF0KDHfHgQopSc28kKvxMaeoQFQWZtfZDo,9455
 odoo/addons/stock_production_lot_warranty/static/description/index.html,sha256=AAei01bTW-gFxQGK_q6puKjj7wuN74pimggO0bcoWb0,14345
 odoo/addons/stock_production_lot_warranty/tests/__init__.py,sha256=B13ZgSNmv1YcEa-Up5rWqHEYbeTIBbMQMlGjojyGNKc,199
-odoo/addons/stock_production_lot_warranty/tests/test_product_lot_warranty.py,sha256=KRrUA7hvPxzYdSZxfGPBBp5GcFKWqWjrZw0uxqrnX38,935
+odoo/addons/stock_production_lot_warranty/tests/test_product_lot_warranty.py,sha256=rGv8R8wSjwktHIzjs3qJnIUOr91nVv01511eZcYxGWs,2926
 odoo/addons/stock_production_lot_warranty/views/stock_production_lot.xml,sha256=uHUk78-l3GQQiVHu-x2Al23FXgvOhDaB4V6iMyagaHk,537
-odoo_addon_stock_production_lot_warranty-15.0.1.0.0.2.dist-info/METADATA,sha256=GSON_Mu3sGZpcK0SslvzuXitx3EihYxCcx3UTSihF_0,4850
-odoo_addon_stock_production_lot_warranty-15.0.1.0.0.2.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-odoo_addon_stock_production_lot_warranty-15.0.1.0.0.2.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo_addon_stock_production_lot_warranty-15.0.1.0.0.2.dist-info/RECORD,,
+odoo_addon_stock_production_lot_warranty-15.0.1.1.0.dist-info/METADATA,sha256=dqQVu-coXVoZJUNoXPkTKBqRHrWtMcCBfffN0yy1q78,4848
+odoo_addon_stock_production_lot_warranty-15.0.1.1.0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+odoo_addon_stock_production_lot_warranty-15.0.1.1.0.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo_addon_stock_production_lot_warranty-15.0.1.1.0.dist-info/RECORD,,
```

