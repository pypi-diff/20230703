# Comparing `tmp/oc_dltool-3.10.3-py3-none-any.whl.zip` & `tmp/oc_dltool-3.11.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,34 +1,33 @@
-Zip file size: 39564 bytes, number of entries: 32
--rw-r--r--  2.0 unx     7994 b- defN 23-Jun-16 09:14 oc_dltoolv2/DeliveryChannels.py
--rw-r--r--  2.0 unx     3347 b- defN 23-Jun-16 09:14 oc_dltoolv2/DeliveryValidations.py
--rw-r--r--  2.0 unx     2292 b- defN 23-Jun-16 09:14 oc_dltoolv2/SqlWrapper.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-16 09:14 oc_dltoolv2/__init__.py
--rw-r--r--  2.0 unx     7525 b- defN 23-Jun-16 09:14 oc_dltoolv2/archiver.py
--rw-r--r--  2.0 unx     8308 b- defN 23-Jun-16 09:14 oc_dltoolv2/build_delivery_from_queue.py
--rw-r--r--  2.0 unx     6257 b- defN 23-Jun-16 09:14 oc_dltoolv2/build_delivery_from_tag.py
--rw-r--r--  2.0 unx     4360 b- defN 23-Jun-16 09:14 oc_dltoolv2/build_steps.py
--rw-r--r--  2.0 unx     2038 b- defN 23-Jun-16 09:14 oc_dltoolv2/db_steps.py
--rw-r--r--  2.0 unx     3802 b- defN 23-Jun-16 09:14 oc_dltoolv2/delivery_artifacts_checker.py
--rw-r--r--  2.0 unx     1686 b- defN 23-Jun-16 09:14 oc_dltoolv2/delivery_attributes.py
--rw-r--r--  2.0 unx     1815 b- defN 23-Jun-16 09:14 oc_dltoolv2/delivery_copyright_appender.py
--rw-r--r--  2.0 unx       51 b- defN 23-Jun-16 09:14 oc_dltoolv2/delivery_exceptions.py
--rw-r--r--  2.0 unx     4296 b- defN 23-Jun-16 09:14 oc_dltoolv2/delivery_info_decoder.py
--rw-r--r--  2.0 unx     3573 b- defN 23-Jun-16 09:14 oc_dltoolv2/delivery_info_helper.py
--rw-r--r--  2.0 unx     1298 b- defN 23-Jun-16 09:14 oc_dltoolv2/distributives_api_client.py
--rw-r--r--  2.0 unx     1305 b- defN 23-Jun-16 09:14 oc_dltoolv2/dlbuild_worker.py
--rw-r--r--  2.0 unx     2229 b- defN 23-Jun-16 09:14 oc_dltoolv2/enhancements.py
--rw-r--r--  2.0 unx       97 b- defN 23-Jun-16 09:14 oc_dltoolv2/errors.py
--rw-r--r--  2.0 unx      986 b- defN 23-Jun-16 09:14 oc_dltoolv2/local_load.py
--rw-r--r--  2.0 unx     2772 b- defN 23-Jun-16 09:14 oc_dltoolv2/notifications.py
--rw-r--r--  2.0 unx     2270 b- defN 23-Jun-16 09:14 oc_dltoolv2/register.py
--rw-r--r--  2.0 unx     1551 b- defN 23-Jun-16 09:14 oc_dltoolv2/releasenotes.py
--rw-r--r--  2.0 unx     8073 b- defN 23-Jun-16 09:14 oc_dltoolv2/resolver.py
--rw-r--r--  2.0 unx     1843 b- defN 23-Jun-16 09:14 oc_dltoolv2/resources.py
--rw-r--r--  2.0 unx     1985 b- defN 23-Jun-16 09:14 oc_dltoolv2/subprocess_wrapper.py
--rw-r--r--  2.0 unx     6474 b- defN 23-Jun-16 09:14 oc_dltoolv2/wrapper.py
--rw-r--r--  2.0 unx    11357 b- defN 23-Jun-16 09:14 oc_dltool-3.10.3.dist-info/LICENSE
--rw-r--r--  2.0 unx      561 b- defN 23-Jun-16 09:14 oc_dltool-3.10.3.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jun-16 09:14 oc_dltool-3.10.3.dist-info/WHEEL
--rw-r--r--  2.0 unx       12 b- defN 23-Jun-16 09:14 oc_dltool-3.10.3.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2738 b- defN 23-Jun-16 09:14 oc_dltool-3.10.3.dist-info/RECORD
-32 files, 102987 bytes uncompressed, 35150 bytes compressed:  65.9%
+Zip file size: 36463 bytes, number of entries: 31
+-rw-r--r--  2.0 unx     7983 b- defN 23-Jul-03 05:31 oc_dltoolv2/DeliveryChannels.py
+-rw-r--r--  2.0 unx     3347 b- defN 23-Jul-03 05:31 oc_dltoolv2/DeliveryValidations.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jul-03 05:31 oc_dltoolv2/__init__.py
+-rw-r--r--  2.0 unx       72 b- defN 23-Jul-03 05:31 oc_dltoolv2/__main__.py
+-rw-r--r--  2.0 unx     7503 b- defN 23-Jul-03 05:31 oc_dltoolv2/archiver.py
+-rw-r--r--  2.0 unx     8584 b- defN 23-Jul-03 05:31 oc_dltoolv2/build_delivery_from_queue.py
+-rw-r--r--  2.0 unx     4298 b- defN 23-Jul-03 05:31 oc_dltoolv2/build_steps.py
+-rw-r--r--  2.0 unx     1935 b- defN 23-Jul-03 05:31 oc_dltoolv2/db_steps.py
+-rw-r--r--  2.0 unx     3797 b- defN 23-Jul-03 05:31 oc_dltoolv2/delivery_artifacts_checker.py
+-rw-r--r--  2.0 unx     1676 b- defN 23-Jul-03 05:31 oc_dltoolv2/delivery_attributes.py
+-rw-r--r--  2.0 unx     1821 b- defN 23-Jul-03 05:31 oc_dltoolv2/delivery_copyright_appender.py
+-rw-r--r--  2.0 unx       51 b- defN 23-Jul-03 05:31 oc_dltoolv2/delivery_exceptions.py
+-rw-r--r--  2.0 unx     4285 b- defN 23-Jul-03 05:31 oc_dltoolv2/delivery_info_decoder.py
+-rw-r--r--  2.0 unx     3505 b- defN 23-Jul-03 05:31 oc_dltoolv2/delivery_info_helper.py
+-rw-r--r--  2.0 unx     1298 b- defN 23-Jul-03 05:31 oc_dltoolv2/distributives_api_client.py
+-rw-r--r--  2.0 unx     1578 b- defN 23-Jul-03 05:31 oc_dltoolv2/dlbuild_worker.py
+-rw-r--r--  2.0 unx     2207 b- defN 23-Jul-03 05:31 oc_dltoolv2/enhancements.py
+-rw-r--r--  2.0 unx       97 b- defN 23-Jul-03 05:31 oc_dltoolv2/errors.py
+-rw-r--r--  2.0 unx      975 b- defN 23-Jul-03 05:31 oc_dltoolv2/local_load.py
+-rw-r--r--  2.0 unx     2779 b- defN 23-Jul-03 05:31 oc_dltoolv2/notifications.py
+-rw-r--r--  2.0 unx     2270 b- defN 23-Jul-03 05:31 oc_dltoolv2/register.py
+-rw-r--r--  2.0 unx     1551 b- defN 23-Jul-03 05:31 oc_dltoolv2/releasenotes.py
+-rw-r--r--  2.0 unx     8051 b- defN 23-Jul-03 05:31 oc_dltoolv2/resolver.py
+-rw-r--r--  2.0 unx     1843 b- defN 23-Jul-03 05:31 oc_dltoolv2/resources.py
+-rw-r--r--  2.0 unx     1985 b- defN 23-Jul-03 05:31 oc_dltoolv2/subprocess_wrapper.py
+-rw-r--r--  2.0 unx     6490 b- defN 23-Jul-03 05:31 oc_dltoolv2/wrapper.py
+-rw-r--r--  2.0 unx    11357 b- defN 23-Jul-03 05:32 oc_dltool-3.11.0.dist-info/LICENSE
+-rw-r--r--  2.0 unx      490 b- defN 23-Jul-03 05:32 oc_dltool-3.11.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jul-03 05:32 oc_dltool-3.11.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx       12 b- defN 23-Jul-03 05:32 oc_dltool-3.11.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2639 b- defN 23-Jul-03 05:32 oc_dltool-3.11.0.dist-info/RECORD
+31 files, 94571 bytes uncompressed, 32205 bytes compressed:  65.9%
```

## zipnote {}

```diff
@@ -1,28 +1,25 @@
 Filename: oc_dltoolv2/DeliveryChannels.py
 Comment: 
 
 Filename: oc_dltoolv2/DeliveryValidations.py
 Comment: 
 
-Filename: oc_dltoolv2/SqlWrapper.py
+Filename: oc_dltoolv2/__init__.py
 Comment: 
 
-Filename: oc_dltoolv2/__init__.py
+Filename: oc_dltoolv2/__main__.py
 Comment: 
 
 Filename: oc_dltoolv2/archiver.py
 Comment: 
 
 Filename: oc_dltoolv2/build_delivery_from_queue.py
 Comment: 
 
-Filename: oc_dltoolv2/build_delivery_from_tag.py
-Comment: 
-
 Filename: oc_dltoolv2/build_steps.py
 Comment: 
 
 Filename: oc_dltoolv2/db_steps.py
 Comment: 
 
 Filename: oc_dltoolv2/delivery_artifacts_checker.py
@@ -75,23 +72,23 @@
 
 Filename: oc_dltoolv2/subprocess_wrapper.py
 Comment: 
 
 Filename: oc_dltoolv2/wrapper.py
 Comment: 
 
-Filename: oc_dltool-3.10.3.dist-info/LICENSE
+Filename: oc_dltool-3.11.0.dist-info/LICENSE
 Comment: 
 
-Filename: oc_dltool-3.10.3.dist-info/METADATA
+Filename: oc_dltool-3.11.0.dist-info/METADATA
 Comment: 
 
-Filename: oc_dltool-3.10.3.dist-info/WHEEL
+Filename: oc_dltool-3.11.0.dist-info/WHEEL
 Comment: 
 
-Filename: oc_dltool-3.10.3.dist-info/top_level.txt
+Filename: oc_dltool-3.11.0.dist-info/top_level.txt
 Comment: 
 
-Filename: oc_dltool-3.10.3.dist-info/RECORD
+Filename: oc_dltool-3.11.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## oc_dltoolv2/DeliveryChannels.py

```diff
@@ -13,15 +13,15 @@
 from oc_pyfs.SvnFS import SvnFS
 from configobj import ConfigObj
 from oc_delivery_apps.dlmanager.DLModels import DeliveryList
 from fs.copy import copy_file
 from fs.errors import ResourceNotFound
 from fs.tempfs import TempFS
 
-from oc_dltoolv2.delivery_attributes import get_tag_delivery_name
+from .delivery_attributes import get_tag_delivery_name
 
 
 class SvnDeliveryChannel(object):
     """
     This channel allows to create tag for delivery.
     Tag URL is based on delivery GAV.
     Also upon tag creation file with delivery parameters is added;
```

## oc_dltoolv2/archiver.py

```diff
@@ -7,16 +7,16 @@
 
 from oc_cdtapi.NexusAPI import parse_gav, gav_to_filename
 from oc_delivery_apps.checksums.controllers import CheckSumsController
 from fs.compress import write_zip
 from fs.errors import DirectoryExists
 from fs.tempfs import TempFS
 import json
-from oc_dltoolv2.delivery_info_decoder import DeliveryInfoDecoder
-from oc_dltoolv2.delivery_copyright_appender import DeliveryCopyrightAppender
+from .delivery_info_decoder import DeliveryInfoDecoder
+from .delivery_copyright_appender import DeliveryCopyrightAppender
 
 
 class DeliveryArchiver(object):
     """ Packages given resources to single zip archive. Resources are placed according to their types """
 
     def __init__(self, work_fs, delivery_params):
         """ :param work_fs: pyfilesystem2-like object. Will be used as work directory. Should be cleaned by calling code """
```

## oc_dltoolv2/build_delivery_from_queue.py

```diff
@@ -1,28 +1,23 @@
-import argparse
 import logging
-import traceback
 import os
 from collections import namedtuple
 
 from oc_cdtapi.NexusAPI import parse_gav
 from oc_connections.ConnectionManager import ConnectionManager
 
-#from cdt.connections.ORMConfigurator import configure_django_orm
 from oc_orm_initializator.orm_initializator import OrmInitializator
-from oc_checksumsq.checksums_interface import ChecksumsQueueClient
-from oc_delivery_apps.dlmanager.DLModels import DeliveryList, InvalidPathError
+import oc_checksumsq.checksums_interface
 from fs.tempfs import TempFS
 
-import oc_dltoolv2.DeliveryChannels as DeliveryChannels
-from oc_dltoolv2.errors import BuildError
-from oc_dltoolv2.notifications import AutoSetupNotificator
-from oc_dltoolv2.distributives_api_client import DistributivesAPIClient
+from .errors import BuildError
+from .notifications import AutoSetupNotificator
+from .distributives_api_client import DistributivesAPIClient
 
-from oc_dltoolv2.delivery_artifacts_checker import DeliveryArtifactsChecker
+from .delivery_artifacts_checker import DeliveryArtifactsChecker
 
 
 class BuildProcess(object):
 
     def __init__(self, *args, **kvargs):
         self.conn_mgr = kvargs.pop('conn_mgr', ConnectionManager())
         self.setup_orm = kvargs.pop('setup_orm', True)
@@ -32,49 +27,68 @@
             self.distributives_api_client = None
         
         self.amqp_exchange = os.getenv("AMQP_EXCHANGE", "cdt.dlartifacts.input")
 
         # self.registration_client.basic_args(self.parser)  # add AMQP-specific arguments
 
         if self.setup_orm:
-            #configure_django_orm(self.conn_mgr, INSTALLED_APPS=[
-            #    "dlmanager", "django.contrib.auth", "django.contrib.contenttypes"])
-            OrmInitializator(installed_apps = ['dlmanager'])
+            _c = {"PSQL_URL": None, "PSQL_USER": None, "PSQL_PASSWORD": None}
+
+            for _k in _c.keys():
+                _c[_k] = kvargs.pop(_k.lower(), "") or os.getenv(_k, "")
+
+                if not _c[_k]:
+                    raise ValueError("'%s' is mandatory" % _k)
+
+            _installed_apps = [
+                    'oc_delivery_apps.dlmanager',
+                    'oc_delivery_apps.checksums']
+
+            OrmInitializator(url=_c.get("PSQL_URL"), user=_c.get("PSQL_USER"), password=_c.get("PSQL_PASSWORD"), installed_apps=_installed_apps)
+        
+        # django models can be imported if django is configured only, so make it here
+        from oc_delivery_apps.dlmanager.DLModels import DeliveryList, InvalidPathError
+        from . import DeliveryChannels
+        self._DeliveryList = DeliveryList
+        self._InvalidPathError = InvalidPathError
+        self._DeliveryChannels = DeliveryChannels
 
     def get_target_delivery_params(self, tag):
         """ Retrieve delivery params from delivery tag
         :param tag: URL of tag to read
         :return: dict of delivery attributes (keys are equal to db model fields) """
         clients_repo = self.conn_mgr.get_url("SVN_CLIENTS")
-        channel = DeliveryChannels.SvnDeliveryChannel(
+        channel = self._DeliveryChannels.SvnDeliveryChannel(
             clients_repo, self.conn_mgr.get_svn_client("SVN"))
         delivery_params = channel.read_delivery_at_branch(tag)
         return delivery_params
 
     def build_process(self, delivery_params):
         """
         Build process pipeline
         :param delivery_params: parsed params from url or tag
         """
         try:
-            # originated from delivery_info.txt in SVN tag. DeliveryList is a django-ORM model
-            delivery_list = DeliveryList(
+            # originated from delivery_info.txt in SVN tag. self._DeliveryList is a django-ORM model
+            delivery_list = self._DeliveryList(
                 delivery_params["mf_delivery_files_specified"])
-        except InvalidPathError as ipe:
-            raise BuildError("Invalid path in delivery list: " + str(ipe))
+        except self._InvalidPathError as ipe:
+            raise BuildError(ipe)
         gav_str = "%s:%s:%s:zip" % tuple(
             delivery_params[key] for key in  # GAV gets created in Delivery Wizard and saved to delivery_info.txt
             ["groupid", "artifactid", "version"])
         gav = parse_gav(gav_str)
 
-        from build_steps import BuildContext, collect_sources, calculate_and_check_checksums, build_delivery, upload_delivery
-        from db_steps import save_delivery_to_db, delivery_is_in_db
+        from .build_steps import BuildContext, collect_sources, calculate_and_check_checksums, build_delivery, upload_delivery
+        from .db_steps import save_delivery_to_db, delivery_is_in_db
 
         if delivery_is_in_db(delivery_params):
+            logging.info("Delivery is in DB already")
             return ProcessStatus("build_process", "WARNING", "Delivery already built and stored in DB", None)
+
         # exceptions at single steps are not processed - they should stop build process
         with TempFS(temp_dir=".") as workdir_fs:
             # BuildContext is just a NamedTuple that has workdir_fs and conn_mgr
             context = BuildContext(workdir_fs, self.conn_mgr)
             resources = collect_sources(
                 delivery_params["mf_tag_svn"], delivery_list, context)
             if self.distributives_api_client:
@@ -84,22 +98,23 @@
 
             if os.getenv('COUNTERPARTY_ENABLED', 'false').lower() in ['true', 'yes', 'y']:
                 DeliveryArtifactsChecker(delivery_params).check_artifacts_included(resources)
 
             archive_path = build_delivery(resources, delivery_params, context)
             upload_delivery(archive_path, gav, context)
             delivery = save_delivery_to_db(delivery_params, resources, context)
-            logging.debug("Delivery was saved to database: " + delivery.gav)
+            logging.debug("Delivery was saved to database, GAV: '%s'" % delivery.gav)
 
             # even if checksums registration will fail, delivery will still be created
             registration_process_res = self.registration_process(
                     delivery, resources, workdir_fs, archive_path, gav, checksums_list)
-            return registration_process_res
 
-            # return (mail_result, reg_result)
+            logging.debug("Registration process done")
+
+            return registration_process_res
 
     def build_delivery_from_tag(self, requested_tag=None):
 
         build_params = {"mf_ci_job": "queue", "mf_ci_build": "0"}
         # don't send notification if delivery params read has failed - we don't know the recipient
         # knows nearly everything about connections to external services like mvn, svn, ...
 
@@ -108,64 +123,66 @@
         # added build number and job name from CI to delivery info
         delivery_params.update(build_params)
         registration_process_res = None
         try:
             registration_process_res = self.build_process(delivery_params)
             build_exception = None
         except Exception as exc:
-            traceback.print_exc()
+            logging.exception(exc)
             build_exception = exc
 
         notify_res = self.notify_client(delivery_params, build_exception)
         build_res = [registration_process_res, notify_res]
+
         if build_exception:
             logging.error("Build failed for tag %s" % requested_tag)
             raise build_exception
-        else:
-            logging.info("Build successful for tag %s" % requested_tag)
-            return build_res
+        
+        logging.info("Build successful for tag %s" % requested_tag)
+        return build_res
 
     def registration_process(self, delivery, resources, workdir_fs, archive_path, gav, checksums_list):
-        from register import register_delivery_content, register_delivery_resource
-        registration_client = ChecksumsQueueClient()
-        parser = argparse.ArgumentParser(
-            description="This script launches build process for delivery specified by groupid:artifactid:version")
-        default_args = registration_client.basic_args(parser).parse_args()
-        default_args.exchange = self.amqp_exchange
-        # Set max priority for messages from dltool
-        default_args.priority = 3
-        registration_client.setup_from_args(default_args)
+        from .register import register_delivery_content, register_delivery_resource
+        registration_client = oc_checksumsq.checksums_interface.ChecksumsQueueClient()
+        registration_client.setup(
+                url=os.getenv("AMQP_URL"),
+                username=os.getenv("AMQP_USER"),
+                password=os.getenv("AMQP_PASSWORD"),
+                routing_key=oc_checksumsq.checksums_interface.queue_name,
+                queue_cnt=oc_checksumsq.checksums_interface.queue_cnt_name,
+                priority=3)
         try:
             registration_client.connect()  # should be called just before sending message
             for resource in resources:
                 register_delivery_resource(resource, registration_client, checksums_list)
-            register_delivery_content(
-                workdir_fs, archive_path, gav, registration_client)
+            register_delivery_content(workdir_fs, archive_path, gav, registration_client)
             registration_client.disconnect()
-            logging.debug("Checksums were computed for " + delivery.gav)
-            return ProcessStatus("registration_process", "OK", "", None)
         except Exception as e:
-            logging.error("An error occured during checksums registration for " + delivery.gav + repr(e))
+            logging.exception(e)
             return ProcessStatus("registration_process", "FAILED", repr(e), e)
 
+        logging.debug("Checksums were computed for GAV: '%s'" % delivery.gav)
+        return ProcessStatus("registration_process", "OK", "", None)
+
     def notify_client(self, delivery_params, build_exception):
         recipient = '@'.join([delivery_params["mf_delivery_author"], os.getenv("MAIL_DOMAIN")])
         gav = {"g": delivery_params["groupid"], "a": delivery_params["artifactid"],
                "v": delivery_params["version"]}
         try:
             with AutoSetupNotificator(conn_mgr=self.conn_mgr) as notificator:
                 if not build_exception or isinstance(build_exception, PreparedDeliveryProcessingError):
                     notificator.send_success_notification(recipient, gav)
-                    return ProcessStatus("notify_client", "OK", "", None)
 
         except Exception as e:  # TODO: replace with Notificator/MailerException
             # ignore errors raised by notification
-            logging.error("An error occured on notification send" + repr(e))
+            logging.exception(e)
             return ProcessStatus("notify_client", "FAILED", repr(e), e)
 
+        return ProcessStatus("notify_client", "OK", "", None)
+
 
 class PreparedDeliveryProcessingError(Exception):
     pass
 
 
 class MailSendError(Exception):
     pass
```

## oc_dltoolv2/build_steps.py

```diff
@@ -1,20 +1,20 @@
 from collections import namedtuple
 
 from oc_pyfs import SvnFS, NexusFS
 from fs import copy as fs_copy
 from fs.tempfs import TempFS
 
-from oc_dltoolv2.SqlWrapper import SqlWrapper
-from oc_dltoolv2.archiver import DeliveryArchiver
-from oc_dltoolv2.local_load import download_resource
-from oc_dltoolv2.resolver import BuildRequestResolver
-from oc_dltoolv2.resources import RequestContext
-from oc_dltoolv2.wrapper import Wrapper
-from oc_dltoolv2.delivery_exceptions import DeliveryDeniedException
+from oc_sql_helpers.wrapper import PLSQLWrapper
+from .archiver import DeliveryArchiver
+from .local_load import download_resource
+from .resolver import BuildRequestResolver
+from .resources import RequestContext
+from .wrapper import Wrapper
+from .delivery_exceptions import DeliveryDeniedException
 from hashlib import md5
 import logging
 
 # Tuple representing working directory and ConnectionManager used to retrieve external connections
 BuildContext = namedtuple("BuildContext", ("local_fs", "conn_mgr"))
 
 def collect_sources(branch_url, delivery_list, context):
@@ -42,15 +42,15 @@
     :param context: BuildContext instance
     :return: path to archive in local_fs """
     local_fs, conn_mgr = context
     svn_client = conn_mgr.get_svn_client("SVN")
     branch_fs = SvnFS.SvnFS(delivery_params["mf_tag_svn"], svn_client)
 
     with TempFS(temp_dir=".") as workdir_fs:
-        wrapper = Wrapper(SqlWrapper())
+        wrapper = Wrapper(PLSQLWrapper())
         wrapped_resources = wrapper.get_wrapped_resources(resources, branch_fs)
         svn_prefix = branch_fs.getsyspath("/")
         archiver = DeliveryArchiver(workdir_fs, delivery_params)
         temp_archive_name = archiver.build_archive(wrapped_resources, svn_prefix)
         fs_copy.copy_file(workdir_fs, temp_archive_name, local_fs, temp_archive_name)
     return temp_archive_name
```

## oc_dltoolv2/db_steps.py

```diff
@@ -1,32 +1,29 @@
 from oc_pyfs.SvnFS import SvnFS
 from django.db.models import Q
 from oc_delivery_apps.dlmanager.models import Delivery
 import logging
 
 
-from oc_dltoolv2.errors import BuildError
+from .errors import BuildError
 
 
 def delivery_is_in_db(delivery_params):
     group_criterion = Q(groupid=delivery_params["groupid"])
     artifact_criterion = Q(artifactid=delivery_params["artifactid"])
     version_criterion = Q(version=delivery_params["version"])
     debug_message = "Check if delivery with GAV %s%s%s is in DB" % (delivery_params["groupid"], delivery_params["artifactid"], delivery_params["version"])
     logging.debug(debug_message)
 
     delivery_number = Delivery.objects.filter(group_criterion &
                                               artifact_criterion &
                                               version_criterion).count()
-    if delivery_number != 0:
-        logging.debug("Delivery is already stored in DB")
-        return True
-    else:
-        logging.debug("Delivery is NOT in DB")
-        return False
+    logging.info("Deliveries in db: %d" % delivery_number)
+
+    return bool(delivery_number)
 
 
 def save_delivery_to_db(delivery_params, resources, context):
     svn_client = context.conn_mgr.get_svn_client("SVN")
     branch_url = delivery_params["mf_tag_svn"]
     branch_fs = SvnFS(branch_url, svn_client)
     svn_prefix = branch_fs.getsyspath("/")
```

## oc_dltoolv2/delivery_artifacts_checker.py

```diff
@@ -1,11 +1,11 @@
 import logging
 import re
-from oc_dltoolv2.delivery_info_helper import DeliveryInfoHelper
-from oc_dltoolv2.delivery_exceptions import DeliveryDeniedException
+from .delivery_info_helper import DeliveryInfoHelper
+from .delivery_exceptions import DeliveryDeniedException
 
 class DeliveryArtifactsChecker(DeliveryInfoHelper):
     def check_artifacts_included(self, delivery_resources):
         """
         Check all necessary artifacts are in the delivery
         :param delivery_resources: pre-final resources list
         :type delivery_resources: list
@@ -26,15 +26,15 @@
 
         logging.debug("Customer code: '%s'" % _customer_code)
 
         # ask ClientProvider to give us a location
         _customer_loc = self._get_customer_location(_customer_code)
 
         if not _customer_loc:
-            logging.warning("Customer '%s' does not have location tag. Artifacts check skipped")
+            logging.warning("Customer '%s' does not have location tag. Artifacts check skipped" % _customer_code)
             return True
 
         _artifacts_necessary, _artifacts_denied = self._get_artifacts_lineup(_customer_loc)
         return self._check_artifacts_lineup(delivery_resources, _artifacts_necessary, _artifacts_denied)
 
     def _get_artifacts_lineup(self, customer_location):
         """
```

## oc_dltoolv2/delivery_attributes.py

```diff
@@ -1,10 +1,10 @@
 import os
 from logging import debug
-from oc_dltoolv2 import DeliveryValidations
+from . import DeliveryValidations
 
 
 def generate_version(timestamp, minor=None):
     """ 
     Generates delivery version in format 'vYYYYmmdd_minor'
     Minor is supposed to be used when delivery with same artifactid created in same day
     """
```

## oc_dltoolv2/delivery_copyright_appender.py

```diff
@@ -1,10 +1,10 @@
 import logging
 import os
-from oc_dltoolv2.delivery_info_helper import DeliveryInfoHelper
+from .delivery_info_helper import DeliveryInfoHelper
 import fs
 
 class DeliveryCopyrightAppender(DeliveryInfoHelper):
     def write_to_file(self, dst_fs, dst_path):
         """
         Write copyright text to a file given
         :param dst_fs: desitnation filesystem
@@ -17,15 +17,15 @@
             # THIS SHOULD NEVER HAPPEN
             raise ValueError("Failed to detect customer code from delivery parameters")
 
         _customer_location = self._get_customer_location(_customer_code)
         logging.info("Customer location for '%s': '%s'" % (_customer_code, _customer_location))
 
         if not _customer_location:
-            logging.warning("Customer '%s' does not have location tag. Copyright appending skipped")
+            logging.warning("Customer '%s' does not have location tag. Copyright appending skipped" % _customer_code)
             return
 
         _t = self._read_artifacts_conf(_customer_location)
         _dom_spec_cpr = _t.get("copyright")
         logging.info("Copyright file name: '%s'" % _dom_spec_cpr)
 
         if not _dom_spec_cpr:
```

## oc_dltoolv2/delivery_info_decoder.py

```diff
@@ -1,11 +1,11 @@
 import json
 import logging
 import fs
-from oc_dltoolv2.delivery_info_helper import DeliveryInfoHelper
+from .delivery_info_helper import DeliveryInfoHelper
 
 ## this may be necessary in the future if we enable 'deliveryArea' tag
 ## currently it is disabled due to absence of evidence in Copyright regulations
 #import urlparse
 
 class DeliveryInfoDecoder(DeliveryInfoHelper):
     def __init__(self, delivery_params, delivery_resources, separators=None):
```

## oc_dltoolv2/delivery_info_helper.py

```diff
@@ -1,13 +1,12 @@
 import posixpath
 import logging
 import requests
 import os
 import json
-from oc_dltoolv2.delivery_exceptions import DeliveryDeniedException
 
 class DeliveryInfoHelper(object):
     def __init__(self, delivery_params):
         """
         Class initialization
         :param delivery_params: parsed configobj array with delivery parameters
         :type delivery_params: dict
```

## oc_dltoolv2/dlbuild_worker.py

```diff
@@ -1,20 +1,29 @@
 import logging
 import os
 from oc_dlinterface.dlbuild_worker_interface import DLBuildQueueServer
-from oc_dltoolv2.build_delivery_from_queue import BuildProcess
 
 
 class DLBuildWorker(DLBuildQueueServer):
 
     def __init__(self, *args, **kwargs):
-        logging.basicConfig(level=logging.DEBUG)
-        api_check_enabled = (os.getenv("DISTRIBUTIVES_API_CHECK_ENABLED", 'false').lower() in ["true", "yes"])
-        self.build_process = BuildProcess(api_check=api_check_enabled, **kwargs)
-        super(DLBuildWorker, self).__init__()
+        self._kwargs = kwargs.copy()
+        kwargs.pop('setup_orm', False)
+        kwargs.pop('conn_mgr', None)
+        super().__init__(*args, **kwargs)
+
+    @property
+    def build_process(self):
+        if not hasattr(self, '_build_process'):
+            api_check_enabled = (os.getenv("DISTRIBUTIVES_API_CHECK_ENABLED", 'false').lower() in ["true", "yes"])
+            logging.info("API check enabled: %s" % api_check_enabled)
+            from .build_delivery_from_queue import BuildProcess
+            self._build_process = BuildProcess(api_check=api_check_enabled, **self._kwargs)
+
+        return self._build_process
 
     def ping(self):
         return
 
     def build_delivery(self, delivery_tag):
         logging.info("Received build delivery request for tag %s" % delivery_tag)
         process_status_list = self.build_process.build_delivery_from_tag(requested_tag=delivery_tag)
@@ -23,10 +32,9 @@
             if process_status.status == "OK":
                 logging.debug(message)
             else:
                 err_message = "; The error is: '%s' (%s)" % (process_status.errmsg, process_status.exception)
                 logging.error(message + err_message)
         return
 
-
 if __name__ == '__main__':
     exit(DLBuildWorker().main())
```

## oc_dltoolv2/enhancements.py

```diff
@@ -1,14 +1,14 @@
 from itertools import chain
 
 from oc_delivery_apps.checksums.models import LocTypes, CiTypes
 from django.core.exceptions import ObjectDoesNotExist
 
-from oc_dltoolv2.releasenotes import get_possible_releasenotes_gavs
-from oc_dltoolv2.resources import LocationStub, FSLocation, FileBasedResourceData, DeliveryResource
+from .releasenotes import get_possible_releasenotes_gavs
+from .resources import LocationStub, FSLocation, FileBasedResourceData, DeliveryResource
 
 
 class DeliveryListEnhancement(object):
     """
     Abstract class for any delivery list enhancements
     """
```

## oc_dltoolv2/local_load.py

```diff
@@ -1,10 +1,10 @@
 import uuid
 
-from oc_dltoolv2.resources import DeliveryResource, ResourceData
+from .resources import DeliveryResource, ResourceData
 
 
 def download_resource(resource, work_fs):
     """ Caches resource locally for faster access 
     :param resource: DeliveryResource to be cached 
     :param work_fs: pyfilesystem2-like object used to place cached content 
     :return: DeliveryResource with same location_stub and LocallyCachedResourceData with cached content """
```

## oc_dltoolv2/notifications.py

```diff
@@ -1,8 +1,8 @@
-from oc_mailer import Mailer
+from oc_mailer.Mailer import Mailer
 from oc_connections.ConnectionManager import ConnectionManager
 import os
 
 
 class Notificator(object):
     """
     Class for sending notifications
```

## oc_dltoolv2/resolver.py

```diff
@@ -5,16 +5,16 @@
 from itertools import chain, groupby
 
 from oc_cdtapi.NexusAPI import parse_gav, gav_to_filename
 from oc_delivery_apps.checksums.models import CiTypes, LocTypes, Locations
 from oc_delivery_apps.dlmanager.DLModels import DeliveryList
 from oc_delivery_apps.dlmanager.models import PrivateFile
 
-from oc_dltoolv2.enhancements import ReleasenotesEnhancement
-from oc_dltoolv2.resources import FSLocation, FileBasedResourceData, DeliveryResource, LocationStub
+from .enhancements import ReleasenotesEnhancement
+from .resources import FSLocation, FileBasedResourceData, DeliveryResource, LocationStub
 
 
 class BuildRequestResolver(object):
     """ Converts DeliveryList given by user (see DLModels) to list of concrete files from repositories.
     Assigns LocTypes and other location info to requested resources; this information is used further by other modules """
 
     def __init__(self):
```

## oc_dltoolv2/wrapper.py

```diff
@@ -3,16 +3,15 @@
 from io import BytesIO
 #from itertools import ifilter, ifilterfalse
 from itertools import filterfalse as ifilterfalse
 
 from fs.errors import ResourceNotFound
 from fs.tempfs import TempFS
 
-from oc_dltoolv2.SqlWrapper import WrappingError
-from oc_dltoolv2.resources import ResourceData, DeliveryResource
+from .resources import ResourceData, DeliveryResource
 
 
 
 class Wrapper(object):
     """ Performs obfuscation of given resources (currently only SQL scripts wrapping) """
 
     def __init__(self, wrap_client):
@@ -30,17 +29,17 @@
         1) custs specified in wrap.txt 
         2) package bodies in owner folders 
         Rules are case-insensitive.
         :param resources: list of DeliveryResource. Non-SVN resources are kept unchanged
         :param svn_fs: SvnFS pointing to root of branch. Used to determine wrap list 
         :return: list of DeliveryResource where files to wrap are replaced with its wrapped versions """
         selected, skipped = self._split_resources(resources, svn_fs)
-        logging.info("To be wrapped: " + ", ".join([resource.location_stub.path
+        logging.info("To be wrapped: [%s]" % ";".join([resource.location_stub.path
                                                    for resource in selected]))
-        wrapped_resources = list (map(self._wrap_resource, selected) )
+        wrapped_resources = list(map(self._wrap_resource, selected))
         resulting_resources = wrapped_resources + skipped
         return resulting_resources
 
     def _split_resources(self, resources, svn_fs):
         is_svn_resource = lambda resource: resource.location_stub.location_type.code == "SVN"
         wrap_list = self._get_files_to_wrap(svn_fs)
         # endswith because path starts with client branch url
@@ -48,19 +47,16 @@
                                            for path in wrap_list)
         is_selected = lambda resource: is_svn_resource(resource) and should_wrap(resource)
         skipped = list(ifilterfalse(is_selected, resources))
         selected = list(filter(is_selected, resources))
         return selected, skipped
 
     def _wrap_resource(self, resource):
-        try:
-            wrapped_data = WrappedResourceData(resource.resource_data, self._wrap_client)
-        except WrappingError:
-            logging.exception("Wrapping failed for %s" % resource.location_stub.path)
-            raise
+        # there may be an exception - raise it then
+        wrapped_data = WrappedResourceData(resource.resource_data, self._wrap_client)
         # wrapping is transparent - location_stub still points to svn
         wrapped_resource = DeliveryResource(resource.location_stub, wrapped_data)
         return wrapped_resource
 
     def _get_files_to_wrap(self, svn_fs):
         c_owner_loc = self.WRAPPER_C_OWNER_LOC
         d_owner_loc = self.WRAPPER_D_OWNER_LOC
@@ -91,14 +87,16 @@
         return files_to_wrap
 
     def _read_wrap_file(self, file_url, folder_url, svn_fs):
         try:
             with svn_fs.open(file_url) as wrap_file:
                 requested_custs = list(filter(lambda y: bool(y), list(map(lambda x: x.strip(), wrap_file.readlines()))))
             existing_custs = svn_fs.listdir(folder_url)
+            logging.debug("Existing custs: [%s]" % (';'.join(existing_custs) if existing_custs else ""))
+            logging.debug("Requested custs: [%s]" % (';'.join(requested_custs) if requested_custs else ""))
             resulting_custs = [cust for cust in existing_custs
                                if cust.lower() in requested_custs]
             return resulting_custs
         except ResourceNotFound as err:
             return []  # no wrap file - no custs to wrap
 
     def _list_private_scripts(self, folder_url, svn_fs):
@@ -117,17 +115,16 @@
         super(ResourceData, self).__init__()
         # assume file is quite small, so wrapped content can be stored in memory
         self._wrapped_content = self._wrap_data(data, wrap_client)
 
     def _wrap_data(self, data, wrap_client):
         with TempFS() as temp_fs:
             with data.get_content() as content_handle:
-                temp_fs.upload("filename", content_handle)
-                wrap_client.wrap_file(temp_fs, "filename")
-                wrapped_content = temp_fs.readbytes("filename")
+                temp_fs.upload("_f.sql", content_handle)
+                wrapped_content = wrap_client.wrap_path(temp_fs.getsyspath("_f.sql"))
         return wrapped_content
 
     def get_content(self):
         return BytesIO(self._wrapped_content)
 
 
 def _join_path(*args):
```

## Comparing `oc_dltool-3.10.3.dist-info/LICENSE` & `oc_dltool-3.11.0.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `oc_dltool-3.10.3.dist-info/RECORD` & `oc_dltool-3.11.0.dist-info/RECORD`

 * *Files 20% similar despite different names*

```diff
@@ -1,32 +1,31 @@
-oc_dltoolv2/DeliveryChannels.py,sha256=mtg4t09uV2LaOybmkDTLoINR54rA-IyuypzPAJTkFNc,7994
+oc_dltoolv2/DeliveryChannels.py,sha256=FHFiStswmiLYQiia4cCNaacCMc3o1UHwLqT2zAYGyzU,7983
 oc_dltoolv2/DeliveryValidations.py,sha256=tRJIEb3cnswm744CwGUu82Y8JKa6Eki0GX890LBVM8I,3347
-oc_dltoolv2/SqlWrapper.py,sha256=mxYae8G0kCeuhJ8O1bGQSfAZ6ekebgP3YQDBYoAFo8A,2292
 oc_dltoolv2/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-oc_dltoolv2/archiver.py,sha256=oRq1tFoHFQ4_ivdq1TWbm23ooZ-LF72Moj_iC0-odXs,7525
-oc_dltoolv2/build_delivery_from_queue.py,sha256=W6vgy1O76OCaot950oC3-k264rrYCadzjrZN1e4y19M,8308
-oc_dltoolv2/build_delivery_from_tag.py,sha256=shgz262xkUFEJ2t45A5aL3FGy1iS8UQiLILRC1L0TuM,6257
-oc_dltoolv2/build_steps.py,sha256=CazwOF5PBbOw-PeLKt0VpSbYvXQ3TcqFOnI1miIjZO4,4360
-oc_dltoolv2/db_steps.py,sha256=uA4qSrWXxCnxq9gmCZuR8Wledox6DHWRB84L8gqLZGk,2038
-oc_dltoolv2/delivery_artifacts_checker.py,sha256=2tOpBTJvoOum8fjO7Sv4PvPYizO-Z-uA2f9oiAnAYF0,3802
-oc_dltoolv2/delivery_attributes.py,sha256=S6bQVJjedk5yuzu-jbySLRrrlQ6b4EBJbZjvYVoWS_E,1686
-oc_dltoolv2/delivery_copyright_appender.py,sha256=dZFtOCSct4IRK4FCgF4yw8PKd1lTHXNXVhcOY2E_udU,1815
+oc_dltoolv2/__main__.py,sha256=Ijr6BQJ4bjdsqopvr5UK8wdeOV-td27Rgm4sVIu5bSU,72
+oc_dltoolv2/archiver.py,sha256=znb3OW1_kxSUher_Gx1aOSBgzKlwibwbPPf66RQuPGI,7503
+oc_dltoolv2/build_delivery_from_queue.py,sha256=a1Jub6-UiQvkDx1mFIkZxDWK5r-fubIeKvzbgPASxDw,8584
+oc_dltoolv2/build_steps.py,sha256=UeitEkS6qNf5kvQGuzf3jBO9_GENbEz4ylYf1jbkVvE,4298
+oc_dltoolv2/db_steps.py,sha256=7TzUOlF2n6NbYPnpsRS_9ihviFIIZyDrwSTuOpf_tz8,1935
+oc_dltoolv2/delivery_artifacts_checker.py,sha256=6p1GRfyzlcOnLwc9oMBQtWsirYSApiUTNb8rOeeJRG4,3797
+oc_dltoolv2/delivery_attributes.py,sha256=-s6qg5afjZZdtpiyDTDrkNwdyM2gbPZxDOHSnrkUWkU,1676
+oc_dltoolv2/delivery_copyright_appender.py,sha256=Pjar3klQocKgXkqNnfoCJYET5tOVR_gPpu-78ujp77I,1821
 oc_dltoolv2/delivery_exceptions.py,sha256=bWWyTElEJcerB3JjuuT--pqCXGOm94NWvmuX3kHKhR0,51
-oc_dltoolv2/delivery_info_decoder.py,sha256=KvTamGEg8D_7QXJiute59X5B7-oQUFXB99fKVYay7Co,4296
-oc_dltoolv2/delivery_info_helper.py,sha256=Sfkg-SFyFWr_hfERtm0zlIzBRUlff6cQ3795vRX9A9o,3573
+oc_dltoolv2/delivery_info_decoder.py,sha256=pV__FjcPBh-kEHxKFldGFZU6zm__0bT3DZXi7XI6f5E,4285
+oc_dltoolv2/delivery_info_helper.py,sha256=WGzIDfjTKgwGfR8hXAu8VmEmVt0EI0lR1O5mKO-m0_I,3505
 oc_dltoolv2/distributives_api_client.py,sha256=r_pRWA_fXOuvbkES5dNlC1xkOMhq9iKB_F15AtK4iS0,1298
-oc_dltoolv2/dlbuild_worker.py,sha256=zMYYEX9UhiWYL3vbyejeL8bSsjUA6qFBaI7NIADxNqQ,1305
-oc_dltoolv2/enhancements.py,sha256=hD6gPUctlttUwrKD3MC47WFiw9QK5cmC2_qDhEFHjyU,2229
+oc_dltoolv2/dlbuild_worker.py,sha256=Rh0OQnmWMJr9TCe6Gb4LDtrcf6Qg_OEIM4HBEBoe0w4,1578
+oc_dltoolv2/enhancements.py,sha256=EBFISK_Ve4WYe0aKZWRqM7q64Px_nzxY8BkO_GJVm4o,2207
 oc_dltoolv2/errors.py,sha256=dXubRPHXQxd7mhP_uhApAbM1QwybIK-UQVQTwpTrxpI,97
-oc_dltoolv2/local_load.py,sha256=m9NdH1mUBcrfwYThkukPkDFKNUJ6VG0a84L4n023WjU,986
-oc_dltoolv2/notifications.py,sha256=TCjytWJUnCzneh8sGyCwIEAADmGsSmMS2AtKhBS6pac,2772
+oc_dltoolv2/local_load.py,sha256=GGmygNVAWNrQUZisL3UR4NiqRPYvMcOOXWazEQWxLW0,975
+oc_dltoolv2/notifications.py,sha256=IF1CK8lplUKDWGEkpX_xNgDfwNQUjjgAsJVpHS1c-O8,2779
 oc_dltoolv2/register.py,sha256=PaaOyftG96eRvdLbc278vLphBPi4wNaKfgxUm-ZIxN4,2270
 oc_dltoolv2/releasenotes.py,sha256=c1roHoO3bqCj5EVsqqjyFNsBKjcXUHeJnnjsKV2_3jA,1551
-oc_dltoolv2/resolver.py,sha256=yQXTcRTnL5HcKnsez9lx0zMShz334VGVzZil9RiVY7M,8073
+oc_dltoolv2/resolver.py,sha256=iWzdOGayrt7S7icjZ5vqHfD_6Vtj1CIgAcanr2LpJds,8051
 oc_dltoolv2/resources.py,sha256=011Rn4AU8HHn54IxK4fGI7qDIyyaTkBvwsfhJBHEDQE,1843
 oc_dltoolv2/subprocess_wrapper.py,sha256=higb6tEM_R8azYC-p7Bx-DYK75PfE5vcY5YxAT8ocDA,1985
-oc_dltoolv2/wrapper.py,sha256=T9TPrxDEZU1c0nw4xWLQQSN71KDRRg8hPN49QIKvbd0,6474
-oc_dltool-3.10.3.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
-oc_dltool-3.10.3.dist-info/METADATA,sha256=RafJIh7apzPckcpE9lwF7ZP-eRWxhMfBMSCBUPtgQWI,561
-oc_dltool-3.10.3.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-oc_dltool-3.10.3.dist-info/top_level.txt,sha256=BiX7uixAkSbW_FzahKjAzZhXIavDVHF7MaxISBLWrh4,12
-oc_dltool-3.10.3.dist-info/RECORD,,
+oc_dltoolv2/wrapper.py,sha256=4gUYnr3DVqvCHrT4Muux8_2F46p23cP7QLLGoKHPyk4,6490
+oc_dltool-3.11.0.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
+oc_dltool-3.11.0.dist-info/METADATA,sha256=rD1P5un2VhrI5rHUsPBoENBZp1utU2HnFSEhkCcqpJs,490
+oc_dltool-3.11.0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+oc_dltool-3.11.0.dist-info/top_level.txt,sha256=BiX7uixAkSbW_FzahKjAzZhXIavDVHF7MaxISBLWrh4,12
+oc_dltool-3.11.0.dist-info/RECORD,,
```

