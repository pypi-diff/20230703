# Comparing `tmp/megfile-2.1.0-py3-none-any.whl.zip` & `tmp/megfile-2.1.1-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,47 +1,47 @@
-Zip file size: 107960 bytes, number of entries: 45
+Zip file size: 108038 bytes, number of entries: 45
 -rw-rw-r--  2.0 unx     5434 b- defN 23-May-25 06:42 megfile/__init__.py
--rw-rw-r--  2.0 unx    10033 b- defN 23-May-25 06:42 megfile/cli.py
+-rw-rw-r--  2.0 unx    10265 b- defN 23-Jun-30 08:29 megfile/cli.py
 -rw-rw-r--  2.0 unx    11349 b- defN 23-Jun-16 11:38 megfile/errors.py
--rw-rw-r--  2.0 unx    11621 b- defN 23-Jun-26 03:29 megfile/fs.py
+-rw-rw-r--  2.0 unx    11621 b- defN 23-Jul-03 03:14 megfile/fs.py
 -rw-rw-r--  2.0 unx    38552 b- defN 23-Jun-16 02:18 megfile/fs_path.py
--rw-rw-r--  2.0 unx     1852 b- defN 23-Jun-26 03:29 megfile/http.py
+-rw-rw-r--  2.0 unx     1852 b- defN 23-Jul-03 03:14 megfile/http.py
 -rw-rw-r--  2.0 unx     4487 b- defN 23-Jun-16 02:18 megfile/http_path.py
 -rw-rw-r--  2.0 unx     6219 b- defN 23-May-25 06:42 megfile/interfaces.py
 -rw-rw-r--  2.0 unx    29307 b- defN 23-Jun-13 05:49 megfile/pathlike.py
--rw-rw-r--  2.0 unx    12456 b- defN 23-Jun-26 03:29 megfile/s3.py
+-rw-rw-r--  2.0 unx    12456 b- defN 23-Jul-03 03:14 megfile/s3.py
 -rw-rw-r--  2.0 unx    84902 b- defN 23-Jun-26 02:12 megfile/s3_path.py
--rw-rw-r--  2.0 unx    11943 b- defN 23-Jun-26 03:29 megfile/sftp.py
--rw-rw-r--  2.0 unx    44863 b- defN 23-Jun-26 03:56 megfile/sftp_path.py
+-rw-rw-r--  2.0 unx    11943 b- defN 23-Jul-03 03:14 megfile/sftp.py
+-rw-rw-r--  2.0 unx    45029 b- defN 23-Jul-03 03:44 megfile/sftp_path.py
 -rw-rw-r--  2.0 unx    31952 b- defN 23-Jun-13 05:49 megfile/smart.py
 -rw-rw-r--  2.0 unx     6708 b- defN 23-Jun-16 02:18 megfile/smart_path.py
--rw-rw-r--  2.0 unx      559 b- defN 23-Jun-26 03:29 megfile/stdio.py
+-rw-rw-r--  2.0 unx      559 b- defN 23-Jul-03 03:14 megfile/stdio.py
 -rw-rw-r--  2.0 unx     2682 b- defN 23-Jun-16 02:18 megfile/stdio_path.py
--rw-rw-r--  2.0 unx       19 b- defN 23-Jun-26 05:35 megfile/version.py
+-rw-rw-r--  2.0 unx       19 b- defN 23-Jul-03 03:40 megfile/version.py
 -rw-rw-r--  2.0 unx        0 b- defN 23-May-25 06:42 megfile/lib/__init__.py
--rw-rw-r--  2.0 unx     4580 b- defN 23-Jun-26 03:30 megfile/lib/combine_reader.py
+-rw-rw-r--  2.0 unx     4580 b- defN 23-Jul-03 03:14 megfile/lib/combine_reader.py
 -rw-rw-r--  2.0 unx     2233 b- defN 23-Jun-13 05:49 megfile/lib/compare.py
 -rw-rw-r--  2.0 unx     3073 b- defN 23-Jun-20 02:11 megfile/lib/compat.py
 -rw-rw-r--  2.0 unx     4054 b- defN 23-May-25 06:42 megfile/lib/fnmatch.py
 -rw-rw-r--  2.0 unx     9752 b- defN 23-Jun-20 02:11 megfile/lib/glob.py
 -rw-rw-r--  2.0 unx      929 b- defN 23-May-25 06:42 megfile/lib/joinpath.py
 -rw-rw-r--  2.0 unx     1915 b- defN 23-May-25 06:42 megfile/lib/lazy_handler.py
 -rw-rw-r--  2.0 unx     6934 b- defN 23-May-25 06:42 megfile/lib/s3_buffered_writer.py
 -rw-rw-r--  2.0 unx     1322 b- defN 23-May-25 06:42 megfile/lib/s3_cached_handler.py
 -rw-rw-r--  2.0 unx     6057 b- defN 23-May-25 06:42 megfile/lib/s3_limited_seekable_writer.py
 -rw-rw-r--  2.0 unx     3725 b- defN 23-May-25 06:42 megfile/lib/s3_memory_handler.py
 -rw-rw-r--  2.0 unx     3404 b- defN 23-May-25 06:42 megfile/lib/s3_pipe_handler.py
 -rw-rw-r--  2.0 unx    15053 b- defN 23-May-25 06:42 megfile/lib/s3_prefetch_reader.py
--rw-rw-r--  2.0 unx     3791 b- defN 23-Jun-26 03:30 megfile/lib/s3_share_cache_reader.py
+-rw-rw-r--  2.0 unx     3791 b- defN 23-Jul-03 03:14 megfile/lib/s3_share_cache_reader.py
 -rw-rw-r--  2.0 unx     2683 b- defN 23-May-25 06:42 megfile/lib/shadow_handler.py
 -rw-rw-r--  2.0 unx     2044 b- defN 23-May-25 06:42 megfile/lib/stdio_handler.py
 -rw-rw-r--  2.0 unx      103 b- defN 23-Jun-16 02:18 megfile/lib/url.py
 -rw-rw-r--  2.0 unx     9025 b- defN 23-May-25 06:42 megfile/utils/__init__.py
 -rw-rw-r--  2.0 unx     2461 b- defN 23-May-25 06:42 megfile/utils/mutex.py
--rw-rw-r--  2.0 unx    11357 b- defN 23-Jun-26 05:36 megfile-2.1.0.dist-info/LICENSE
--rw-rw-r--  2.0 unx     1080 b- defN 23-Jun-26 05:36 megfile-2.1.0.dist-info/LICENSE.pyre
--rw-rw-r--  2.0 unx    10154 b- defN 23-Jun-26 05:36 megfile-2.1.0.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 23-Jun-26 05:36 megfile-2.1.0.dist-info/WHEEL
--rw-rw-r--  2.0 unx       49 b- defN 23-Jun-26 05:36 megfile-2.1.0.dist-info/entry_points.txt
--rw-rw-r--  2.0 unx        8 b- defN 23-Jun-26 05:36 megfile-2.1.0.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     3603 b- defN 23-Jun-26 05:36 megfile-2.1.0.dist-info/RECORD
-45 files, 424419 bytes uncompressed, 102330 bytes compressed:  75.9%
+-rw-rw-r--  2.0 unx    11357 b- defN 23-Jul-03 03:54 megfile-2.1.1.dist-info/LICENSE
+-rw-rw-r--  2.0 unx     1080 b- defN 23-Jul-03 03:54 megfile-2.1.1.dist-info/LICENSE.pyre
+-rw-rw-r--  2.0 unx    10154 b- defN 23-Jul-03 03:54 megfile-2.1.1.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 23-Jul-03 03:54 megfile-2.1.1.dist-info/WHEEL
+-rw-rw-r--  2.0 unx       49 b- defN 23-Jul-03 03:54 megfile-2.1.1.dist-info/entry_points.txt
+-rw-rw-r--  2.0 unx        8 b- defN 23-Jul-03 03:54 megfile-2.1.1.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     3603 b- defN 23-Jul-03 03:54 megfile-2.1.1.dist-info/RECORD
+45 files, 424817 bytes uncompressed, 102408 bytes compressed:  75.9%
```

## zipnote {}

```diff
@@ -108,29 +108,29 @@
 
 Filename: megfile/utils/__init__.py
 Comment: 
 
 Filename: megfile/utils/mutex.py
 Comment: 
 
-Filename: megfile-2.1.0.dist-info/LICENSE
+Filename: megfile-2.1.1.dist-info/LICENSE
 Comment: 
 
-Filename: megfile-2.1.0.dist-info/LICENSE.pyre
+Filename: megfile-2.1.1.dist-info/LICENSE.pyre
 Comment: 
 
-Filename: megfile-2.1.0.dist-info/METADATA
+Filename: megfile-2.1.1.dist-info/METADATA
 Comment: 
 
-Filename: megfile-2.1.0.dist-info/WHEEL
+Filename: megfile-2.1.1.dist-info/WHEEL
 Comment: 
 
-Filename: megfile-2.1.0.dist-info/entry_points.txt
+Filename: megfile-2.1.1.dist-info/entry_points.txt
 Comment: 
 
-Filename: megfile-2.1.0.dist-info/top_level.txt
+Filename: megfile-2.1.1.dist-info/top_level.txt
 Comment: 
 
-Filename: megfile-2.1.0.dist-info/RECORD
+Filename: megfile-2.1.1.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## megfile/cli.py

```diff
@@ -27,32 +27,42 @@
 def safe_cli():  # pragma: no cover
     try:
         cli()
     except Exception as e:
         click.echo(f"\n[{type(e).__name__}] {e}", err=True)
 
 
-def simple_echo(file, show_full_path: bool = False):
-    click.echo(file.path if show_full_path else file.name)
+def get_echo_path(file_stat, base_path: str = ""):
+    if base_path == file_stat.path:
+        path = file_stat.name
+    else:
+        path = os.path.relpath(file_stat.path, start=base_path)
+    return path
+
+
+def simple_echo(file_stat, base_path: str = ""):
+    click.echo(get_echo_path(file_stat, base_path))
 
 
-def long_echo(file, show_full_path: bool = False):
+def long_echo(file_stat, base_path: str = ""):
     click.echo(
         '%12d %s %s' % (
-            file.stat.size,
-            time.strftime("%Y-%m-%d %H:%M:%S", time.localtime(
-                file.stat.mtime)), file.path if show_full_path else file.name))
+            file_stat.stat.size,
+            time.strftime(
+                "%Y-%m-%d %H:%M:%S", time.localtime(file_stat.stat.mtime)),
+            get_echo_path(file_stat, base_path)))
 
 
-def human_echo(file, show_full_path: bool = False):
+def human_echo(file_stat, base_path: str = ""):
     click.echo(
         '%10s %s %s' % (
-            get_human_size(file.stat.size),
-            time.strftime("%Y-%m-%d %H:%M:%S", time.localtime(
-                file.stat.mtime)), file.path if show_full_path else file.name))
+            get_human_size(file_stat.stat.size),
+            time.strftime(
+                "%Y-%m-%d %H:%M:%S", time.localtime(file_stat.stat.mtime)),
+            get_echo_path(file_stat, base_path)))
 
 
 def smart_list_stat(path):
     if smart_isfile(path):
         yield FileEntry(os.path.basename(path), path, smart_stat(path))
     else:
         yield from smart_scandir(path)
@@ -75,32 +85,32 @@
 )
 @click.option(
     '-h',
     '--human-readable',
     is_flag=True,
     help='Displays file sizes in human readable format.')
 def ls(path: str, long: bool, recursive: bool, human_readable: bool):
-    show_full_path = False
+    base_path = path
     if has_magic(path):
         scan_func = smart_glob_stat
-        show_full_path = True
+        base_path = get_non_glob_dir(path)
     elif recursive:
         scan_func = smart_scan_stat
     else:
         scan_func = smart_list_stat
     if long:
         if human_readable:
             echo_func = human_echo
         else:
             echo_func = long_echo
     else:
         echo_func = simple_echo
 
-    for file in scan_func(path):
-        echo_func(file, show_full_path)
+    for file_stat in scan_func(path):
+        echo_func(file_stat, base_path)
 
 
 @cli.command(
     short_help='Copy files from source to dest, skipping already copied.')
 @click.argument('src_path')
 @click.argument('dst_path')
 @click.option(
```

## megfile/sftp_path.py

```diff
@@ -419,14 +419,15 @@
 
     command = [
         'cat', *map(get_real_path, src_paths), '>',
         get_real_path(dst_path)
     ]
     exec_result = dst_path_obj._exec_command(command)
     if exec_result.returncode != 0:
+        _logger.error(exec_result.stderr)
         raise OSError(f'Failed to concat {src_paths} to {dst_path}')
 
 
 @SmartPath.register
 class SftpPath(URIPath):
     """sftp protocol
 
@@ -970,15 +971,15 @@
         return self.lstat().is_symlink()
 
     def cwd(self) -> 'SftpPath':
         '''Return current working directory
 
         returns: Current working directory
         '''
-        return self._generate_path_object(self._client.getcwd())
+        return self._generate_path_object(self._client.normalize('.'))
 
     def save(self, file_object: BinaryIO):
         '''Write the opened binary stream to path
         If parent directory of path doesn't exist, it will be created.
 
         :param file_object: stream to be read
         '''
@@ -1034,17 +1035,19 @@
                 port=self._urlsplit_parts.port,
                 username=self._urlsplit_parts.username,
                 password=self._urlsplit_parts.password,
         ) as chan:
             chan.settimeout(timeout)
             if environment:
                 chan.update_environment(environment)
-            chan.exec_command(' '.join(shlex.quote(arg) for arg in command))
-            stdout = chan.makefile("r", bufsize)
-            stderr = chan.makefile_stderr("r", bufsize)
+            chan.exec_command(' '.join([shlex.quote(arg) for arg in command]))
+            stdout = chan.makefile(
+                "r", bufsize).read().decode(errors="backslashreplace")
+            stderr = chan.makefile_stderr(
+                "r", bufsize).read().decode(errors="backslashreplace")
             returncode = chan.recv_exit_status()
         return subprocess.CompletedProcess(
             args=command, returncode=returncode, stdout=stdout, stderr=stderr)
 
     def copy(
             self,
             dst_path: PathLike,
```

## megfile/version.py

```diff
@@ -1 +1 @@
-VERSION = "2.1.0"
+VERSION = "2.1.1"
```

## Comparing `megfile-2.1.0.dist-info/LICENSE` & `megfile-2.1.1.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `megfile-2.1.0.dist-info/LICENSE.pyre` & `megfile-2.1.1.dist-info/LICENSE.pyre`

 * *Files identical despite different names*

## Comparing `megfile-2.1.0.dist-info/METADATA` & `megfile-2.1.1.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: megfile
-Version: 2.1.0
+Version: 2.1.1
 Summary: Megvii file operation library
 Home-page: https://github.com/megvii-research/megfile
 Author: megvii
 Author-email: megfile@megvii.com
 Classifier: Development Status :: 4 - Beta
 Classifier: Environment :: Console
 Classifier: Intended Audience :: Developers
```

## Comparing `megfile-2.1.0.dist-info/RECORD` & `megfile-2.1.1.dist-info/RECORD`

 * *Files 11% similar despite different names*

```diff
@@ -1,25 +1,25 @@
 megfile/__init__.py,sha256=wlijLJS6F8Vdm1xjpsjd9fKBeDGpgIMrVsXYSeOQ4Xw,5434
-megfile/cli.py,sha256=t299Wo9lA0EbZlS5k3tCxW19liCqY7-i7zbu8oHOwHo,10033
+megfile/cli.py,sha256=nIrugxYRV_FnW_SdHSi5Oy9R5n90LLDA7ApcTSkWCnA,10265
 megfile/errors.py,sha256=H5wCiVBvOtQo5cu3JLhAUCpQJsCkPNm1KNw9o8y4Las,11349
 megfile/fs.py,sha256=sjkm_LsvNCw8hj9Ee-1HSNzvg7bRHTPem8KTDDBQlCw,11621
 megfile/fs_path.py,sha256=xadMpuqRCdr3CLFmRMg6lTlZfSvnPbc_Dql23NO24SU,38552
 megfile/http.py,sha256=EtyFazgenIhEvkwMpX6ga32POKUG21969Y2cRQbFn58,1852
 megfile/http_path.py,sha256=nmmKLRM5I3SozEfX0m9BcHhSaq8LE4SLTTkBjvQnVEc,4487
 megfile/interfaces.py,sha256=h3tWE8hVt5S-HopaMAX6lunPJ97vzhv6jH_2HubcDNc,6219
 megfile/pathlike.py,sha256=52e6POtMfUCC3Hb9XNwBLXM3Gkz3aGP8H8AagGKlDSg,29307
 megfile/s3.py,sha256=hlXqQvZuXuDJbLjsrK23LD25cblThO9f-r78eWFsYZ8,12456
 megfile/s3_path.py,sha256=QoVHvOAO-ewYHXYIyKiJXzXNsmnITZg8u1c1dSxvOvE,84902
 megfile/sftp.py,sha256=qzfgI-MGzNsr7adUQaiVKS7zRHGuK-Hs6o45wNIAcww,11943
-megfile/sftp_path.py,sha256=HNdHHoKMi-dzqPPLvryvghk0jAUp_2NcjGDF77wnuGw,44863
+megfile/sftp_path.py,sha256=1rEV4ixyfRSJjuYMtk921bWF9-6DMJsrrYzpOsXSGUo,45029
 megfile/smart.py,sha256=l4orTpsYzwuNkg0mdS-gBy2_iZ8asL8UUhqMzztN2xQ,31952
 megfile/smart_path.py,sha256=Rwb1McXsshi9-F6miTRqE6j8FO2j1edjmSxZF32YZ6E,6708
 megfile/stdio.py,sha256=qmi1c7VTll6Y6ya9MCd-dSKffocX2GafA-YUncZRU1Y,559
 megfile/stdio_path.py,sha256=ULMzGOj7SBMn3c7fYVSDepT_1nEUiVetc-xRt2pR5o4,2682
-megfile/version.py,sha256=j1-bN_VZExs-u1BflO4MA-2nY5KM66mpuQ5jNZKyJe8,19
+megfile/version.py,sha256=MzwQJEblSoFpJCKZzzBmn4YLW9jfGWnX9FdgPOQMX6c,19
 megfile/lib/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 megfile/lib/combine_reader.py,sha256=TkjvYvM5ZBVCh3tA7cOmTe8dYZc_eI7XbpPhnzqaNvU,4580
 megfile/lib/compare.py,sha256=yG2fZve_gMg32rQVCdwixBdqgYRsjn-24TqhALQaOrA,2233
 megfile/lib/compat.py,sha256=eEwcFLU82aZHmJSjpbmj54YMn-FNM8gGTgnnX60LYjU,3073
 megfile/lib/fnmatch.py,sha256=HgdlnEWBsdFUOZqnW_v1kj1jeH_9lMcCqW85pyMu4vM,4054
 megfile/lib/glob.py,sha256=L5PniK6PWzpfUrWgOHxOAzZzSg4k7l2JbN8jWNfCq4E,9752
 megfile/lib/joinpath.py,sha256=D4Px6-lnDDpYs1LMUHkTIGqMPJQ0oCBGfTzREs373iU,929
@@ -32,14 +32,14 @@
 megfile/lib/s3_prefetch_reader.py,sha256=zSd_gmpDtQCDA-Rrh7Nxh2WOb0Z8Q1QZZg1g7WO6JNg,15053
 megfile/lib/s3_share_cache_reader.py,sha256=q3MVEDUgOvalO7js6S_LWQ-eJS4xFHiio8ZoJZt40e4,3791
 megfile/lib/shadow_handler.py,sha256=IbFyTw107t-yWH0cGrDjAJX-CS3xeEr77_PTGsnSgk4,2683
 megfile/lib/stdio_handler.py,sha256=QDWtcZxz-hzi-rqQUiSlR3NrihX1fjK_Rj9T2mdTFEg,2044
 megfile/lib/url.py,sha256=VbQLjo0s4AaV0iSk66BcjI68aUTcN9zBZ5x6-cM4Qvs,103
 megfile/utils/__init__.py,sha256=gWplPIHzpSqV9AiQiRvUrBCkD737caNYyudsgwQBbKk,9025
 megfile/utils/mutex.py,sha256=BE16gbmZxr0RgU0ULaAFVDTZGwiOA-Jven-fDeG3ltQ,2461
-megfile-2.1.0.dist-info/LICENSE,sha256=WNHhf_5RCaeuKWyq_K39vmp9F28LxKsB4SpomwSZ2L0,11357
-megfile-2.1.0.dist-info/LICENSE.pyre,sha256=9lf5nT-5ZH25JijpYAequ0bl8E8z5JmZB1qrjiUMp84,1080
-megfile-2.1.0.dist-info/METADATA,sha256=wJ4hO5yrpcEzP663oMbDkR5vMDNsRcLqdG9kI3kK70g,10154
-megfile-2.1.0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-megfile-2.1.0.dist-info/entry_points.txt,sha256=M6ZWSSv5_5_QtIpZafy3vq7WuOJ_5dSGQQnEZbByt2Q,49
-megfile-2.1.0.dist-info/top_level.txt,sha256=i3rMgdU1ZAJekAceojhA-bkm3749PzshtRmLTbeLUPQ,8
-megfile-2.1.0.dist-info/RECORD,,
+megfile-2.1.1.dist-info/LICENSE,sha256=WNHhf_5RCaeuKWyq_K39vmp9F28LxKsB4SpomwSZ2L0,11357
+megfile-2.1.1.dist-info/LICENSE.pyre,sha256=9lf5nT-5ZH25JijpYAequ0bl8E8z5JmZB1qrjiUMp84,1080
+megfile-2.1.1.dist-info/METADATA,sha256=shJ3xQu7QZaQoVbhA89w_j9711WqAEgUTFyLmN9CtOk,10154
+megfile-2.1.1.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+megfile-2.1.1.dist-info/entry_points.txt,sha256=M6ZWSSv5_5_QtIpZafy3vq7WuOJ_5dSGQQnEZbByt2Q,49
+megfile-2.1.1.dist-info/top_level.txt,sha256=i3rMgdU1ZAJekAceojhA-bkm3749PzshtRmLTbeLUPQ,8
+megfile-2.1.1.dist-info/RECORD,,
```

